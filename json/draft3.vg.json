{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "params": [
        {
            "name": "zoom_level",
            "value": 36000,
            "bind": {
                "input": "range",
                "min": 15000,
                "max": 36000,
                "step": 200,
                "name": "Zoom: "
            }
        },
        {
            "name": "center_to",
            "value": [144.2, -37.4],
            "bind": {
            "input": "select",
            "options": [
            [144.2, -37.4],
            [150,-33.3],
            [152.5,-27.1]
            ],
            "labels": ["Melbourne", "Sydney", "Brisbane"],
            "name": "Capital City: "
            }
        }
    ],

    "hconcat": [
        {
            "width": 800,
            "height": 450,
            "title": "",
            "projection": {"type": "equirectangular", "center":{"expr": "center_to"}, "scale": {"expr": "zoom_level"}},
            "layer": [
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/jfoo-monash/FIT_3179_Assignment_2/refs/heads/main/json/australia.json",
                        "format":{"type": "topojson", "feature": "australia"}
                    },
                    "mark": {"type": "geoshape", "stroke":"grey", "fill": "white"}
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/jfoo-monash/FIT_3179_Assignment_2/refs/heads/main/json/melbourne_sa2.json",
                        "format": {"type": "topojson", "feature": "melbourne_sa2"}
                    },
                    "transform": [
                        {"calculate": "datum.properties.Aust_Tot_resp + datum.properties.English_Tot_resp", "as": "nonethnic"},
                        {"calculate": "format((datum.properties.Tot_P_Tot_resp - datum.nonethnic)/datum.properties.Tot_P_Tot_resp * 100,'.1f')", "as": "ratio"}
                    ],
                    "mark": {"type": "geoshape", "stroke":"grey"},
                    "encoding": {
                        "color": {
                            "field": "ratio",
                            "type": "quantitative",
                            "scale": {"type": "linear"},
                            "title": "Ethnic share of population (%)"
                        },                                                      
                        "tooltip": [
                            {"field": "properties.SA2_NAME_2021", "type": "nominal", "title": "Statistical Area"},
                            {"field": "properties.Tot_P_Tot_resp", "type": "quantitative", "title": "Total population"},
                            {"field": "ratio", "type": "quantitative", "title": "Ethnic share of population (%)"}
                        ]
                    }
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/jfoo-monash/FIT_3179_Assignment_2/refs/heads/main/json/sydney_sa2.json",
                        "format": {"type": "topojson", "feature": "sydney_sa2"}
                    },
                    "transform": [
                        {"calculate": "datum.properties.Aust_Tot_resp + datum.properties.English_Tot_resp", "as": "nonethnic"},
                        {"calculate": "format((datum.properties.Tot_P_Tot_resp - datum.nonethnic)/datum.properties.Tot_P_Tot_resp * 100,'.1f')", "as": "ratio"}
                    ],
                    "mark": {"type": "geoshape", "stroke":"grey"},
                    "encoding": {
                        "color": {
                            "field": "ratio",
                            "type": "quantitative",
                            "scale": {"type": "linear"},
                            "title": "Ethnic share of population (%)"
                        },                                                      
                        "tooltip": [
                            {"field": "properties.SA2_NAME_2021", "type": "nominal", "title": "Statistical Area"},
                            {"field": "properties.Tot_P_Tot_resp", "type": "quantitative", "title": "Total population"},
                            {"field": "ratio", "type": "quantitative", "title": "Ethnic share of population (%)"}
                        ]
                    }
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/jfoo-monash/FIT_3179_Assignment_2/refs/heads/main/json/brisbane_sa2.json",
                        "format": {"type": "topojson", "feature": "brisbane_sa2"}
                    },
                    "transform": [
                        {"calculate": "datum.properties.Aust_Tot_resp + datum.properties.English_Tot_resp", "as": "nonethnic"},
                        {"calculate": "format((datum.properties.Tot_P_Tot_resp - datum.nonethnic)/datum.properties.Tot_P_Tot_resp * 100,'.1f')", "as": "ratio"}
                    ],
                    "mark": {"type": "geoshape", "stroke":"grey"},
                    "encoding": {
                        "color": {
                            "field": "ratio",
                            "type": "quantitative",
                            "scale": {"type": "linear"},
                            "title": "Ethnic share of population (%)"
                        },                                                      
                        "tooltip": [
                            {"field": "properties.SA2_NAME_2021", "type": "nominal", "title": "Statistical Area"},
                            {"field": "properties.Tot_P_Tot_resp", "type": "quantitative", "title": "Total population"},
                            {"field": "ratio", "type": "quantitative", "title": "Ethnic share of population (%)"}
                        ]
                    }
                }
            ]
        
        },
        {
            "data": {
                "url": "https://raw.githubusercontent.com/jfoo-monash/FIT_3179_Assignment_2/refs/heads/main/json/melbourne_sa2.json",
                "format": {"type": "topojson", "feature": "melbourne_sa2"}
            },
            "transform": [
                {
                    "fold": ["properties.English_Tot_resp","properties.Aust_Tot_resp", "properties.Irish_Tot_resp", "properties.Scottish_Tot_resp", "properties.Chinese_Tot_resp"], "as": ["key", "value"]
                },
                {
                    "calculate": "datum.key == 'properties.Aust_Tot_resp' ? 'Australian' : datum.key == 'properties.English_Tot_resp' ? 'English' : datum.key == 'properties.Irish_Tot_resp' ? 'Irish' : datum.key == 'properties.Scottish_Tot_resp' ? 'Scottish' : datum.key == 'properties.Chinese_Tot_resp' ? 'Chinese' : datum.key",
                    "as": "x-axis-key"
                }

            ],
            "mark": {"type": "bar"},
            "encoding": {
                "x":{"field": "x-axis-key", "type": "nominal", "title": "Ancestry"},
                "y":{"field": "value", "type": "quantitative", "title": "Melbourne Total Persons"}
            }
        }
    ]
}